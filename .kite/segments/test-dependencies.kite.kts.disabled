// Test using external dependency (Gson) with @file:DependsOn annotation
@file:DependsOn("com.google.code.gson:gson:2.10.1")

import com.google.gson.Gson

segments {
    segment("test-json") {
        description = "Test external dependency with Gson via @DependsOn"
        execute {
            val gson = Gson()

            val data = mapOf(
                "project" to "Kite",
                "version" to "0.1.0",
                "language" to "Kotlin",
                "features" to listOf(
                    "Type-safe DSL",
                    "Parallel execution",
                    "Dependency resolution",
                    "@DependsOn annotation support!"
                )
            )

            val json = gson.toJson(data)
            println("✅ JSON serialization with @DependsOn successful!")
            println(json)
        }
    }

    segment("test-json-parse") {
        description = "Test parsing JSON with Gson via @DependsOn"
        dependsOn("test-json")
        execute {
            val gson = Gson()

            val jsonString = """
                {
                    "name": "Test Segment",
                    "status": "running",
                    "timestamp": 1234567890
                }
            """.trimIndent()

            @Suppress("UNCHECKED_CAST")
            val parsed = gson.fromJson(jsonString, Map::class.java) as Map<String, Any>
            println("✅ JSON parsing with @DependsOn successful!")
            println("Parsed data: $parsed")
        }
    }
}