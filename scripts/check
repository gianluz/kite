#!/bin/bash
#
# Quick script to run quality checks
#
# Usage:
#   ./scripts/check           # Run all checks
#   ./scripts/check ktlint    # Run only ktlint
#   ./scripts/check detekt    # Run only detekt
#   ./scripts/check fix       # Auto-fix ktlint issues
#

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$SCRIPT_DIR/.."
KITE_CLI="$PROJECT_ROOT/kite-cli/build/install/kite-cli/bin/kite-cli"

# Build Kite CLI if needed
if [ ! -f "$KITE_CLI" ]; then
    echo "ğŸ“¦ Building Kite CLI..."
    cd "$PROJECT_ROOT"
    ./gradlew :kite-cli:installDist --quiet
fi

cd "$PROJECT_ROOT"

case "${1:-all}" in
    ktlint)
        echo "ğŸ” Running ktlint..."
        "$KITE_CLI" segment ktlint
        ;;
    detekt)
        echo "ğŸ” Running detekt..."
        "$KITE_CLI" segment detekt
        ;;
    fix)
        echo "ğŸ”§ Auto-fixing ktlint issues..."
        ./gradlew ktlintFormat
        echo "âœ… Done! Run './scripts/check' to verify."
        ;;
    all|*)
        echo "ğŸ” Running all quality checks..."
        "$KITE_CLI" segment quality-checks
        ;;
esac
